<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        
        <link href="styles.css" rel="stylesheet" type="text/css">
        
        <script src="jquery-2.1.0.min.js" type="text/javascript"></script>
        <script src="peer.min.js" type="text/javascript"></script>
        
        <title>721 Vs.</title>
    </head>
    <body>
        <div id="stage">
            <h2>Pokemon 721 Vs.</h2>
            
            Your ID: <input type="text" disabled id="yourId"></input>
            Friend ID: <input type="text" id="friendId"></input>
            <input type="button" value="Connect" id="connect"></input>
            <br>
            <br>
            <input type="text" id="message" value="testerino"></input>
            <input type="button" value="Send" id="send"></input>
            
            <div id="log"></div>
            
        </div>
        
        <script>
            var log = $("#log");
            var peer = new Peer({
                key: 'yd1nanm1c4fxyldi'
            });
            var conn = null;
            
            $(document).ready(function() {
                peer.on('open', function(id) {
                    $("#yourId").val(id);
                });
                
                function bindConnection(c) {
                    conn = c;
                    log.append("receinved connection<BR>");
                    
                    conn.on('open', function() {
                        conn.on('data', function(data) {
                            log.append(data + "<br>");
                        });
                    });
                }
                
                peer.on('connection', function(c) {
                    bindConnection(c);
                });
                
                $("#connect").bind('click', function(e) {
                    e.preventDefault();
                    
                    c = peer.connect($("#friendId").val());
                    bindConnection(c);
                });
                
                $("#send").bind('click', function(e) {
                    e.preventDefault();
                    
                    conn.send($("#message").val());
                    debugger;
                    log.append("sent data<BR>");
                });
            });
        </script>
    </body>
</html>